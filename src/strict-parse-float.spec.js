/* eslint-env jest */

const strictParseFloat = require('./strict-parse-float')

describe('strict-parse-float', () => {
  it('does not work for non-strings', () => {
    expect(() => strictParseFloat()).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(undefined)).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(null)).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(false)).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(true)).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(NaN)).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(0)).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat([])).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat({})).toThrowError('Cannot parse a non-string')
    expect(() => strictParseFloat(() => {})).toThrowError('Cannot parse a non-string')
  })

  it('does not work for some strings', () => {
    expect(() => strictParseFloat('')).toThrowError('Invalid argument: ')
    expect(() => strictParseFloat('-')).toThrowError('Invalid argument:')
    expect(() => strictParseFloat('e')).toThrowError('Invalid argument: e')
    expect(() => strictParseFloat('E')).toThrowError('Invalid argument: E')
    expect(() => strictParseFloat('1E')).toThrowError('Invalid argument: 1E')
    expect(() => strictParseFloat('2+')).toThrowError('Invalid argument: 2+')
    expect(() => strictParseFloat('2e+')).toThrowError('Invalid argument: 2e+')
    expect(() => strictParseFloat('e+0')).toThrowError('Invalid argument: e+0')
    expect(() => strictParseFloat('e1')).toThrowError('Invalid argument: e1')
  })

  it('works for regular integers', () => {
    expect(strictParseFloat('0')).toBe(0)
    expect(strictParseFloat('1')).toBe(1)
    expect(strictParseFloat('-789')).toBe(-789)
    expect(strictParseFloat('93045701703')).toBe(93045701703)
    expect(strictParseFloat('9007199254740991')).toBe(9007199254740991)
    expect(strictParseFloat('9007199254740991')).toBe(Number.MAX_SAFE_INTEGER) // Same thing
  })

  it('behaves correctly with large integers', () => {
    expect(strictParseFloat('9007199254740992')).toBe(9007199254740992)
    expect(() => strictParseFloat('9007199254740993')).toThrowError()
    expect(strictParseFloat('9007199254740994')).toBe(9007199254740994)

    expect(strictParseFloat('179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368')).toBe(179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368)
    expect(strictParseFloat('179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368')).toBe(Number.MAX_VALUE) // Same thing
    expect(() => strictParseFloat('179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858369')).toThrowError('Number 179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858369 cannot be precisely represented as a JavaScript number; the closest we can get is 179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368')

    expect(() => strictParseFloat('999e9999')).toThrowError('Number 999e9999 is too large to be precisely represented as a JavaScript number')
  })

  it('behaves correctly with decimals', () => {
    expect(strictParseFloat('0.5')).toBe(0.5)

    expect(() => strictParseFloat('0.1')).toThrowError()
    expect(strictParseFloat('0.1000000000000000055511151231257827021181583404541015625')).toBe(0.1000000000000000055511151231257827021181583404541015625)
    expect(strictParseFloat('0.1000000000000000055511151231257827021181583404541015625')).toBe(0.1) // Same thing
    expect(() => strictParseFloat('0.1000000000000000055511151231257827021181583404541015626')).toThrowError('Number 0.1000000000000000055511151231257827021181583404541015626 cannot be precisely represented as a JavaScript number; the closest we can get is 0.1000000000000000055511151231257827021181583404541015625')

    expect(() => strictParseFloat('0.2')).toThrowError()
    expect(strictParseFloat('0.200000000000000011102230246251565404236316680908203125')).toBe(0.200000000000000011102230246251565404236316680908203125)
    expect(strictParseFloat('0.200000000000000011102230246251565404236316680908203125')).toBe(0.2) // Same thing
    expect(() => strictParseFloat('0.200000000000000011102230246251536316680908203125')).toThrowError()

    expect(() => strictParseFloat('0.3')).toThrowError()
    expect(strictParseFloat('0.299999999999999988897769753748434595763683319091796875')).toBe(0.299999999999999988897769753748434595763683319091796875)
    expect(strictParseFloat('0.299999999999999988897769753748434595763683319091796875')).toBe(0.3) // Same thing
    expect(() => strictParseFloat('0.299999999999999999997769753748434595763683319091796875')).toThrowError()

    expect(() => strictParseFloat('0.30000000000000004')).toThrowError()
    expect(strictParseFloat('0.3000000000000000444089209850062616169452667236328125')).toBe(0.3000000000000000444089209850062616169452667236328125)
    expect(strictParseFloat('0.3000000000000000444089209850062616169452667236328125')).toBe(0.30000000000000004) // Same thing
    expect(() => strictParseFloat('0.3000000000000000444444444444444444444444444444444444')).toThrowError()
  })

  it('handles very small decimals', () => {
    expect(strictParseFloat('0.0000000000000002220446049250313080847263336181640625')).toBe(0.0000000000000002220446049250313080847263336181640625)
    expect(strictParseFloat('0.0000000000000002220446049250313080847263336181640625')).toBe(Number.EPSILON) // Same thing
    expect(() => strictParseFloat('0.0000000000000002220446049250313080847263336181640624')).toThrow()

    expect(strictParseFloat('0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000988131291682493088353137585736442744730119605228649528851171365001351014540417503730599672723271984759593129390891435461853313420711879592797549592021563756252601426380622809055691634335697964207377437272113997461446100012774818307129968774624946794546339230280063430770796148252477131182342053317113373536374079120621249863890543182984910658610913088802254960259419999083863978818160833126649049514295738029453560318710477223100269607052986944038758053621421498340666445368950667144166486387218476578691673612021202301233961950615668455463665849580996504946155275185449574931216955640746893939906729403594535543517025132110239826300978220290207572547633450191167477946719798732961988232841140527418055848553508913045817507736501283943653106689453125')).toBe(0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000988131291682493088353137585736442744730119605228649528851171365001351014540417503730599672723271984759593129390891435461853313420711879592797549592021563756252601426380622809055691634335697964207377437272113997461446100012774818307129968774624946794546339230280063430770796148252477131182342053317113373536374079120621249863890543182984910658610913088802254960259419999083863978818160833126649049514295738029453560318710477223100269607052986944038758053621421498340666445368950667144166486387218476578691673612021202301233961950615668455463665849580996504946155275185449574931216955640746893939906729403594535543517025132110239826300978220290207572547633450191167477946719798732961988232841140527418055848553508913045817507736501283943653106689453125)
    expect(strictParseFloat('0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000988131291682493088353137585736442744730119605228649528851171365001351014540417503730599672723271984759593129390891435461853313420711879592797549592021563756252601426380622809055691634335697964207377437272113997461446100012774818307129968774624946794546339230280063430770796148252477131182342053317113373536374079120621249863890543182984910658610913088802254960259419999083863978818160833126649049514295738029453560318710477223100269607052986944038758053621421498340666445368950667144166486387218476578691673612021202301233961950615668455463665849580996504946155275185449574931216955640746893939906729403594535543517025132110239826300978220290207572547633450191167477946719798732961988232841140527418055848553508913045817507736501283943653106689453125')).toBe(Number.MIN_VALUE * 2) // Same thing
    expect(() => strictParseFloat('0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000988131291682493088353137585736442744730119605228649528851171365001351014540417503730599672723271984759593129390891435461853313420711879592797549592021563756252601426380622809055691634335697964207377437272113997461446100012774818307129968774624946794546339230280063430770796148252477131182342053317113373536374079120621249863890543182984910658610913088802254960259419999083863978818160833126649049514295738029453560318710477223100269607052986944038758053621421498340666445368950667144166486387218476578691673612021202301233961950615668455463665849580996504946155275185449574931216955640746893939906729403594535543517025132110239826300978220290207572547633450191167477946719798732961988232841140527418055848553508913045817507736501283943653106689453125')).toThrow()
    expect(() => strictParseFloat('0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000098813129168249308835313758573644274473011960522864952885117136500135101454041750373059967272327198475959312939089143546185331342071187959279754959202156375625260142638062280905569163433569796420737743727211399746144610001277481830712996877462494679454633923028006343077079614825247713118234205331711337353637407912062124986389054318298491065861091308880225496025941999908386397881816083312664904951429573802945356031871047722310026960705298694403875805362142149834066644536895066714416648638721847657869167361202120230123396195061566845546366584958099650494615527518544957493121695564074689393990672940359453554351702513211023982630097822029020757254763345019116747794671979873296198823284114052741805584855350891304581750773650128394365310668945312509')).toThrow()

    expect(() => strictParseFloat('5e-324')).toThrowError('Number 5e-324 cannot be precisely represented as a JavaScript number; the closest we can get is 0')
    expect(strictParseFloat('0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625')).toBe(Number.MIN_VALUE)
  })

  it('handles negatives', () => {
    expect(strictParseFloat('-9007199254740991')).toBe(-9007199254740991) // MAX_SAFE_INTEGER
    expect(strictParseFloat('-0')).toBe(-0)
    expect(strictParseFloat('-0.1000000000000000055511151231257827021181583404541015625')).toBe(-0.1000000000000000055511151231257827021181583404541015625)
    expect(() => strictParseFloat('-0.1000000000000000055511151231257827021181583404541015626')).toThrowError('Number -0.1000000000000000055511151231257827021181583404541015626 cannot be precisely represented as a JavaScript number; the closest we can get is -0.1000000000000000055511151231257827021181583404541015625')
  })
})
